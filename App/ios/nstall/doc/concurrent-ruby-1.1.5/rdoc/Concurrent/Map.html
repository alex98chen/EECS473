<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Concurrent::Map - concurrent-ruby-1.1.5 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Concurrent::Collection::MapImplementation
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    
    <li class="calls-super" ><a href="#method-i-5B-5D">#[]</a>
    
    <li ><a href="#method-i-each">#each</a>
    
    <li ><a href="#method-i-each_key">#each_key</a>
    
    <li class="calls-super" ><a href="#method-i-each_pair">#each_pair</a>
    
    <li ><a href="#method-i-each_value">#each_value</a>
    
    <li ><a href="#method-i-empty-3F">#empty?</a>
    
    <li ><a href="#method-i-fetch">#fetch</a>
    
    <li ><a href="#method-i-fetch_or_store">#fetch_or_store</a>
    
    <li ><a href="#method-i-get">#get</a>
    
    <li ><a href="#method-i-index">#index</a>
    
    <li class="calls-super" ><a href="#method-i-initialize_copy">#initialize_copy</a>
    
    <li ><a href="#method-i-inspect">#inspect</a>
    
    <li ><a href="#method-i-key">#key</a>
    
    <li ><a href="#method-i-keys">#keys</a>
    
    <li ><a href="#method-i-marshal_dump">#marshal_dump</a>
    
    <li ><a href="#method-i-marshal_load">#marshal_load</a>
    
    <li ><a href="#method-i-populate_from">#populate_from</a>
    
    <li ><a href="#method-i-put_if_absent">#put_if_absent</a>
    
    <li ><a href="#method-i-raise_fetch_no_key">#raise_fetch_no_key</a>
    
    <li ><a href="#method-i-size">#size</a>
    
    <li ><a href="#method-i-validate_options_hash-21">#validate_options_hash!</a>
    
    <li ><a href="#method-i-value-3F">#value?</a>
    
    <li ><a href="#method-i-values">#values</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Concurrent::Map">
  <h1 id="class-Concurrent::Map" class="class">
    class Concurrent::Map
  </h1>

  <section class="description">
    
<p>`Concurrent::Map` is a hash-like object and should have much better performance characteristics, especially under high concurrency, than `Concurrent::Hash`. However, `Concurrent::Map `is not strictly semantically equivalent to a ruby `Hash` â€“ for instance, it does not necessarily retain ordering by insertion time as `Hash` does. For most uses it should do fine though, and we recommend you consider `Concurrent::Map` instead of `Concurrent::Hash` for your concurrency-safe hash needs.</p>

  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(options = nil, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!method delete_pair(key, value)</p>

<pre>Delete pair and its value if current value equals the provided value.
@param [Object] key
@param [Object] value
@return [true, false] true if deleted
@!macro map.atomic_method</pre>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 118</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">options</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">Hash</span>)
    <span class="ruby-identifier">validate_options_hash!</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">options</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-ivar">@default_proc</span> = <span class="ruby-identifier">block</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-5B-5D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">[]</span><span
            class="method-args">(key)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Get a value with key @param [Object] key @return [Object] the value</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="5B-5D-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 132</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">[]</span>(<span class="ruby-identifier">key</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span> = <span class="ruby-keyword">super</span> <span class="ruby-comment"># non-falsy value is an existing mapping, return it right away</span>
    <span class="ruby-identifier">value</span>
    <span class="ruby-comment"># re-check is done with get_or_default(key, NULL) instead of a simple !key?(key) in order to avoid a race condition, whereby by the time the current thread gets to the key?(key) call</span>
    <span class="ruby-comment"># a key =&gt; value mapping might have already been created by a different thread (key?(key) would then return true, this elsif branch wouldn&#39;t be taken and an incorrent +nil+ value</span>
    <span class="ruby-comment"># would be returned)</span>
    <span class="ruby-comment"># note: nil == value check is not technically necessary</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@default_proc</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">value</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">NULL</span> <span class="ruby-operator">==</span> (<span class="ruby-identifier">value</span> = <span class="ruby-identifier">get_or_default</span>(<span class="ruby-identifier">key</span>, <span class="ruby-constant">NULL</span>))
    <span class="ruby-ivar">@default_proc</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">key</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">value</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="Map.html#method-i-get">get</a>
        </div>
        

        
      </div>

    
      <div id="method-i-each" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">each</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="Map.html#method-i-each_pair">each_pair</a>
        </div>
        
      </div>

    
      <div id="method-i-each_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">each_key</span><span
            class="method-args">() { |k| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Iterates over each key. @yield for each key in the map @yieldparam key [Object] @return [self] @!macro map.atomic_method_with_block</p>
          
          

          
          <div class="method-source-code" id="each_key-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 241</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">each_key</span>
  <span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-identifier">k</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-each_pair" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">each_pair</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Iterates over each key value pair. @yield for each key value pair in the map @yieldparam key [Object] @yieldparam value [Object] @return [self] @!macro map.atomic_method_with_block</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="each_pair-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 260</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">each_pair</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">enum_for</span> <span class="ruby-value">:each_pair</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="Map.html#method-i-each">each</a>
        </div>
        

        
      </div>

    
      <div id="method-i-each_value" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">each_value</span><span
            class="method-args">() { |v| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Iterates over each value. @yield for each value in the map @yieldparam value [Object] @return [self] @!macro map.atomic_method_with_block</p>
          
          

          
          <div class="method-source-code" id="each_value-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 250</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">each_value</span>
  <span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-identifier">v</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-empty-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">empty?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Is map empty? @return [true, false]</p>
          
          

          
          <div class="method-source-code" id="empty-3F-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 278</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">empty?</span>
  <span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> }
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-fetch" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">fetch</span><span
            class="method-args">(key, default_value = NULL) { |key| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Get a value with key, or default_value when key is absent, or fail when no default_value is given. @param [Object] key @param [Object] default_value @yield default value for a key @yieldparam key [Object] @yieldreturn [Object] default value @return [Object] the value or default value @raise [KeyError] when key is missing and no default_value is provided @!macro map_method_not_atomic</p>

<pre>@note The &quot;fetch-then-act&quot; methods of `Map` are not atomic. `Map` is intended
  to be use as a concurrency primitive with strong happens-before
  guarantees. It is not intended to be used as a high-level abstraction
  supporting complex operations. All read and write operations are
  thread safe, but no guarantees are made regarding race conditions
  between the fetch operation and yielding to the block. Additionally,
  this method does not support recursion. This is due to internal
  constraints that are very unlikely to change in the near future.</pre>
          
          

          
          <div class="method-source-code" id="fetch-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 168</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">fetch</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">default_value</span> = <span class="ruby-constant">NULL</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">NULL</span> <span class="ruby-operator">!=</span> (<span class="ruby-identifier">value</span> = <span class="ruby-identifier">get_or_default</span>(<span class="ruby-identifier">key</span>, <span class="ruby-constant">NULL</span>))
    <span class="ruby-identifier">value</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">block_given?</span>
    <span class="ruby-keyword">yield</span> <span class="ruby-identifier">key</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-constant">NULL</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">default_value</span>
    <span class="ruby-identifier">default_value</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise_fetch_no_key</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-fetch_or_store" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">fetch_or_store</span><span
            class="method-args">(key, default_value = NULL) { |key| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Fetch value with key, or store default value when key is absent, or fail when no default_value is given. This is a two step operation, therefore not atomic. The store can overwrite other concurrently stored value. @param [Object] key @param [Object] default_value @yield default value for a key @yieldparam key [Object] @yieldreturn [Object] default value @return [Object] the value or default value @!macro map.atomic_method_with_block</p>
          
          

          
          <div class="method-source-code" id="fetch_or_store-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 191</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">fetch_or_store</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">default_value</span> = <span class="ruby-constant">NULL</span>)
  <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">put</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">block_given?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">yield</span>(<span class="ruby-identifier">key</span>) <span class="ruby-operator">:</span> (<span class="ruby-constant">NULL</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">default_value</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">raise_fetch_no_key</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">default_value</span>))
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">get</span><span
            class="method-args">(key)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="Map.html#method-i-5B-5D">[]</a>
        </div>
        
      </div>

    
      <div id="method-i-index" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">index</span><span
            class="method-args">(value)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="Map.html#method-i-key">key</a>
        </div>
        
      </div>

    
      <div id="method-i-inspect" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">inspect</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!visibility private</p>
          
          

          
          <div class="method-source-code" id="inspect-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 308</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">inspect</span>
  <span class="ruby-identifier">format</span> <span class="ruby-string">&#39;%s entries=%d default_proc=%s&gt;&#39;</span>, <span class="ruby-identifier">to_s</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>], <span class="ruby-identifier">size</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-ivar">@default_proc</span>.<span class="ruby-identifier">inspect</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">key</span><span
            class="method-args">(value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Find key of a value. @param [Object] value @return [Object, nil] key or nil when not found</p>
          
          

          
          <div class="method-source-code" id="key-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 270</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">key</span>(<span class="ruby-identifier">value</span>)
  <span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-keyword">return</span> <span class="ruby-identifier">k</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">value</span> }
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="Map.html#method-i-index">index</a>
        </div>
        

        
      </div>

    
      <div id="method-i-keys" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">keys</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>All keys @return [::Array&lt;Object&gt;] keys</p>
          
          

          
          <div class="method-source-code" id="keys-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 222</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">keys</span>
  <span class="ruby-identifier">arr</span> = []
  <span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">k</span> }
  <span class="ruby-identifier">arr</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-marshal_dump" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">marshal_dump</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!visibility private</p>
          
          

          
          <div class="method-source-code" id="marshal_dump-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 292</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">marshal_dump</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-string">&quot;can&#39;t dump hash with default proc&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@default_proc</span>
  <span class="ruby-identifier">h</span> = {}
  <span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span> }
  <span class="ruby-identifier">h</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-marshal_load" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">marshal_load</span><span
            class="method-args">(hash)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!visibility private</p>
          
          

          
          <div class="method-source-code" id="marshal_load-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 300</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">marshal_load</span>(<span class="ruby-identifier">hash</span>)
  <span class="ruby-identifier">initialize</span>
  <span class="ruby-identifier">populate_from</span>(<span class="ruby-identifier">hash</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-put_if_absent" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">put_if_absent</span><span
            class="method-args">(key, value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Insert value into map with key if key is absent in one atomic step. @param [Object] key @param [Object] value @return [Object, nil] the value or nil when key was present</p>
          
          

          
          <div class="method-source-code" id="put_if_absent-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 201</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">put_if_absent</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-identifier">computed</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">result</span>   = <span class="ruby-identifier">compute_if_absent</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">computed</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">value</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">computed</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-size" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">size</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The size of map. @return [Integer] size</p>
          
          

          
          <div class="method-source-code" id="size-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 285</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">size</span>
  <span class="ruby-identifier">count</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> }
  <span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-value-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">value?</span><span
            class="method-args">(value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Is the value stored in the map. Iterates over all values. @param [Object] value @return [true, false]</p>
          
          

          
          <div class="method-source-code" id="value-3F-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 213</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">value?</span>(<span class="ruby-identifier">value</span>)
  <span class="ruby-identifier">each_value</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">equal?</span>(<span class="ruby-identifier">v</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-values" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">values</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>All values @return [::Array&lt;Object&gt;] values</p>
          
          

          
          <div class="method-source-code" id="values-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 230</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">values</span>
  <span class="ruby-identifier">arr</span> = []
  <span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">v</span> }
  <span class="ruby-identifier">arr</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

    
      <div id="method-i-initialize_copy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">initialize_copy</span><span
            class="method-args">(other)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="initialize_copy-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 318</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize_copy</span>(<span class="ruby-identifier">other</span>)
  <span class="ruby-keyword">super</span>
  <span class="ruby-identifier">populate_from</span>(<span class="ruby-identifier">other</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-populate_from" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">populate_from</span><span
            class="method-args">(hash)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="populate_from-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 323</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">populate_from</span>(<span class="ruby-identifier">hash</span>)
  <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-keyword">self</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span> }
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-raise_fetch_no_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">raise_fetch_no_key</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="raise_fetch_no_key-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 314</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">raise_fetch_no_key</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">KeyError</span>, <span class="ruby-string">&#39;key not found&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validate_options_hash-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validate_options_hash!</span><span
            class="method-args">(options)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="validate_options_hash-21-source">
            <pre><span class="ruby-comment"># File lib/concurrent/map.rb, line 328</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validate_options_hash!</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">initial_capacity</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:initial_capacity</span>]) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">initial_capacity</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Integer</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">initial_capacity</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;:initial_capacity must be a positive Integer&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">load_factor</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:load_factor</span>]) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">load_factor</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Numeric</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">load_factor</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">load_factor</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;:load_factor must be a number between 0 and 1&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

